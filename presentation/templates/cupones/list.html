{% extends "base.html" %}
{% block title %}Lista de Cupones{% endblock %}

{% block content %}
<div class="container-fluid">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="mb-1">Gestión de Cupones</h2>
          <p class="text-muted mb-0">Administra todos tus códigos de descuento</p>
        </div>
        <a href="{% url 'crear' %}" class="btn btn-primary">
          <i class="fas fa-plus me-2"></i>Nuevo Cupón
        </a>
      </div>
    </div>
  </div>

  <!-- Search and Filters Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body py-3">
          <form class="row g-3 align-items-center" method="get">
            <div class="col-md-8">
              <div class="input-group">
                <span class="input-group-text">
                  <i class="fas fa-search"></i>
                </span>
                <input 
                  class="form-control" 
                  type="search" 
                  placeholder="Buscar por código o nombre del cupón..." 
                  name="q" 
                  value="{{ request.GET.q }}"
                >
              </div>
            </div>
            <div class="col-md-4">
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-outline-primary flex-fill">
                  Buscar
                </button>
                {% if request.GET.q %}
                <a href="{% url request.resolver_match.url_name %}" class="btn btn-outline-secondary">
                  <i class="fas fa-times"></i>
                </a>
                {% endif %}
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-ticket-alt me-2"></i>Lista de Cupones
            </h5>
            <small class="text-muted">
              {% if cupones %}
                {{ cupones|length }} cupón{{ cupones|length|pluralize:"es" }} encontrado{{ cupones|length|pluralize:"s" }}
              {% endif %}
            </small>
          </div>
        </div>
        
        <div class="card-body p-0">
          {% if cupones %}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="border-0 ps-4">
                      <i class="fas fa-tag me-2 text-muted"></i>Nombre
                    </th>
                    <th class="border-0">
                      <i class="fas fa-code me-2 text-muted"></i>Código
                    </th>
                    <th class="border-0">
                      <i class="fas fa-layer-group me-2 text-muted"></i>Tipo
                    </th>
                    <th class="border-0 text-center">
                      <i class="fas fa-toggle-on me-2 text-muted"></i>Estado
                    </th>
                    <th class="border-0">
                      <i class="fas fa-clock me-2 text-muted"></i>Última modificación
                    </th>
                    <th class="border-0 text-center pe-4">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for cupon in cupones %}
                    <tr class="align-middle">
                      <td class="ps-4">
                        <div class="fw-medium">{{ cupon.name }}</div>
                      </td>
                      <td>
                        <code class="bg-light px-2 py-1 rounded">{{ cupon.cupon_code }}</code>
                      </td>
                      <td>
                        <span class="text-capitalize">{{ cupon.coupon_type }}</span>
                      </td>
                      <td class="text-center">
                        {% if cupon.active %}
                          <span class="badge bg-success-subtle text-success border border-success-subtle">
                            <i class="fas fa-check-circle me-1"></i>Activo
                          </span>
                        {% else %}
                          <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">
                            <i class="fas fa-times-circle me-1"></i>Inactivo
                          </span>
                        {% endif %}
                      </td>
                      <td>
                        <div class="text-sm">
                          <div>{{ cupon.last_modification|date:"d/m/Y" }}</div>
                          <small class="text-muted">{{ cupon.last_modification|date:"H:i" }}</small>
                        </div>
                      </td>
                      <td class="text-center pe-4">
                        <div class="d-flex justify-content-center gap-1">
                          <!-- Botón Ver -->
                          <a 
                            href="{% url 'detalle' cupon.cupon_code %}" 
                            class="btn btn-outline-info btn-sm"
                            title="Ver detalles"
                            data-bs-toggle="tooltip"
                          >
                            <i class="fas fa-eye"></i>
                          </a>
                          
                          <!-- Botón Editar -->
                          <a 
                            href="{% url 'editar' cupon.cupon_code %}" 
                            class="btn btn-outline-warning btn-sm"
                            title="Editar cupón"
                            data-bs-toggle="tooltip"
                          >
                            <i class="fas fa-edit"></i>
                          </a>
                          
                          <!-- Botón Eliminar -->
                          <a 
                            href="{% url 'eliminar' cupon.cupon_code %}" 
                            class="btn btn-outline-danger btn-sm"
                            title="Eliminar cupón"
                            data-bs-toggle="tooltip"
                            onclick="return confirm('¿Estás seguro de que deseas eliminar este cupón?')"
                          >
                            <i class="fas fa-trash"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <!-- Empty State -->
            <div class="text-center py-5">
              <div class="mb-3">
                <i class="fas fa-ticket-alt fa-3x text-muted"></i>
              </div>
              <h5 class="text-muted mb-2">No hay cupones disponibles</h5>
              <p class="text-muted mb-4">
                {% if request.GET.q %}
                  No se encontraron cupones que coincidan con tu búsqueda.
                {% else %}
                  Comienza creando tu primer cupón de descuento.
                {% endif %}
              </p>
              {% if not request.GET.q %}
                <a href="{% url 'crear' %}" class="btn btn-primary">
                  <i class="fas fa-plus me-2"></i>Crear primer cupón
                </a>
              {% else %}
                <div class="d-flex justify-content-center gap-2">
                  <a href="{% url request.resolver_match.url_name %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Ver todos
                  </a>
                  <a href="{% url 'crear' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Crear cupón
                  </a>
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CSS personalizado adicional -->
<style>
  .text-sm {
    font-size: 0.875rem;
  }
  
  .table th {
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  
  .badge {
    font-size: 0.75rem;
    padding: 0.375rem 0.75rem;
  }
  
  code {
    font-size: 0.875rem;
  }
  
  .dropdown-toggle::after {
    display: none;
  }
  
  .card {
    border: 1px solid rgba(0,0,0,0.08);
  }
  
  .input-group-text {
    background-color: #f8f9fa;
    border-right: none;
  }
  
  .form-control:focus {
    border-left: 1px solid #86b7fe;
  }
  
  /* Estilos mejorados para botones de acción */
  .btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
    min-width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Hover effects para botones de acción */
  .btn-outline-info:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,123,255,0.2);
  }
  
  .btn-outline-warning:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(255,193,7,0.2);
  }
  
  .btn-outline-danger:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(220,53,69,0.2);
  }
  
  /* Transiciones suaves */
  .btn {
    transition: all 0.2s ease-in-out;
  }
  
  /* Tooltips personalizados */
  .tooltip {
    font-size: 0.75rem;
  }
</style>

<!-- Script para inicializar tooltips -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});
</script>
{% endblock %}
